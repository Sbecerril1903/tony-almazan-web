<?phprequire_once ("config.inc.php");require_once ("clases/template.class.php");require_once ("clases/usuarios.class.php");require_once ("clases/cursos.class.php");require 'vendor/autoload.php';include("$path/xajax.php");setcookie('cross-site-cookie', 'name', ['samesite' => 'None', 'secure' => true]);\Stripe\Stripe::setApiKey('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');//\Stripe\Stripe::setApiKey('sk_test_51MCCJLCxHudoOj2wtUpCDBLOwmmxKIZfQo5mntIRnrSTKHcdT3aCd8hE8z5mxS8UfBsh3LBp0YcKE91z3TyoU5Al00OfcmYTBG');$YOUR_DOMAIN = 'https://tonyalmazan.com/';$ajax = $xajax->getJavascript("/");$oTemplate  = new gb_template("templates");$oUsuario   = new Usuarios();$oCursos   = new Cursos();if (isset($_POST["o"])) {	$opcion = $_POST["o"];} else {	$opcion = $_GET["o"];}session_start();$_SESSION["sessionIdUsuario"];if($_SESSION["sessionIdUsuario"]!= ""){	$estatus_menu ="<li style='color: #3A3A60;' id='menu_logout'><a href='?o=mi-cuenta'   class='top-btn'>MI CUENTA</a></li>";}else{	$estatus_menu ="<li style='color: #3A3A60;' id='menu_login'><a  href='#'  data-toggle='modal'  data-target='#modal' class='top-btn' >INGRESAR A CURSO</a></li>"; }$strHTMLIndex = "";switch ($opcion) {///////////Funciones de usuario 	case "salir":		$oUsuario->killerSession();		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("login.tpl.php")."\";");		header("Location: $url_master");		die;	break;	case "editClient":		$oUsuario->activa(11);		$oUsuario->editarUsuario($_POST);		die;	break;	case "verificarSession":		$valor 	 = $oUsuario->verificarSession($_POST);		echo $session = $oUsuario->iniciarSession($valor);		die;	break;	case "cerrarSession":		//$oUsuario->activa(11);		$oUsuario->killerSession();		eval("\$content = \"".$oTemplate->get_template("views/inicio.tpl.php")."\";");		eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;	case 'error':		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("login.tpl.php")."\";");		$strHTMLIndex .= '<script>swal("Ha fallado la autenticación", "Verifique que el usuario y/o contraseña sean correctos", "error");</script>';		break;	case "detallecurso":		eval("\$content = \"".$oTemplate->get_template("views/detalle.tpl.php")."\";");		eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;	case "email-validation":		$id = base64_decode($_GET['id']);		eval("\$content = \"".$oTemplate->get_template("views/email_validation.tpl.php")."\";");		eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;	case "mi-cuenta":		$oUsuario->activa(11);	    	$id_usuario = $_SESSION['sessionIdUsuario'];			$datos = $oUsuario->datosUsuario($id_usuario);					$nombre_cliente = $datos["Nombre"];			$apellidos = $datos["Apellido"];			$telefono = $datos["Telefono"];			$correo = $datos["Usuario"];		if($_SESSION["Curso"] == 1){			$modulos = $oCursos->modulos();			eval("\$content = \"".$oTemplate->get_template("views/videocurso.tpl.php")."\";");		}		else{			$modulos ="Sin Curso aun";			eval("\$content = \"".$oTemplate->get_template("views/sinCurso.tpl.php")."\";");		}						eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;		case "checkout":		if($_SESSION["Curso"] == 1){			$boton ="<a  href='?o=pay'  data-toggle='modal'  data-target='#modal' class='btn'  style='color:white'>Pagar</a>"; 		}		else{			$boton ="<a  href='#'  data-toggle='modal'  data-target='#modal' class='btn' style='color:white'>Registrarse y Pagar</a>"; 		}		eval("\$content = \"".$oTemplate->get_template("views/carrito.tpl.php")."\";");		eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;	case "mi-curso":			$oUsuario->activa(11);	    	$id_usuario = $_SESSION['sessionIdUsuario'];			$datos = $oUsuario->datosUsuario($id_usuario);			$nombre_cliente = $datos["Nombre"];			$apellidos = $datos["Apellido"];			$telefono = $datos["Telefono"];			$correo = $datos["Usuario"];				if($_SERVER["HTTP_REFERER"]=="https://checkout.stripe.com/"){			$_SESSION["Curso"] = 1;			$oUsuario->actualizarCurso($_GET['user']);			$gracias = "<div class='card' style='padding:20px'><h3>Felicidades <b>$nombre_cliente</b> por dar el primer paso a tu Libertad Financiera y gracias por usar nuestro sistema para lograrlo.</h3></div>";		}		if($_SESSION["Curso"] == 1){			$modulos = $oCursos->modulos();			eval("\$content = \"".$oTemplate->get_template("views/videocurso.tpl.php")."\";");		}		else{			$modulos ="Sin Curso aun";			eval("\$content = \"".$oTemplate->get_template("views/sinCurso.tpl.php")."\";");		}						eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;	case "pay":		$user_id = $_SESSION["sessionIdUsuario"];		header('Content-Type: application/json');		   # Provide the exact Price ID (e.g. pr_1234) of the product you want to sell		  		$checkout_session = \Stripe\Checkout\Session::create([		  'line_items' => [[		    //'price' => 'price_1Mlz2YCxHudoOj2wkfYhSsZt',		    //'price' => 'price_1MlyKYCxHudoOj2w8IfmthS5',		    'price' => 'price_1Mlz2YCxHudoOj2w7u3TeH0z',		    'quantity' => 1,		  ]],		  'mode' => 'payment',		  'client_reference_id'=> $user_id,		  'success_url' => $YOUR_DOMAIN . "/?o=mi-curso&user=$user_id",		  'cancel_url' => $YOUR_DOMAIN . "/?o=cancel&user=$user_id",		  'automatic_tax' => [		    'enabled' => true,		  ],		]);		header("HTTP/1.1 303 See Other");		header("Location: " . $checkout_session->url);	break;	default:		eval("\$content = \"".$oTemplate->get_template("views/inicio.tpl.php")."\";");		eval("\$modal= \"".$oTemplate->get_template("components/modal_login.component.php")."\";");		eval("\$alert= \"".$oTemplate->get_template("components/alerta.component.php")."\";");		eval("\$footer= \"".$oTemplate->get_template("layout/footer.tpl.php")."\";");		eval("\$menu= \"".$oTemplate->get_template("layout/menu.tpl.php")."\";");		eval("\$strHTMLIndex .= \"".$oTemplate->get_template("home.tpl.php")."\";");	break;}echo $strHTMLIndex;?>